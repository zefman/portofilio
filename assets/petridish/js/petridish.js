!function(){"use strict";function t(t,e,o,i){function a(){x=$(window).innerWidth(),b=$(window).innerHeight(),y=document.getElementById("canvas"),v=y.getContext("2d"),$("canvas").attr("width",x),$("canvas").attr("height",b),angular.element(e).bind("resize",function(){x=e.innerWidth,b=e.innerHeight,$("canvas").attr("width",x),$("canvas").attr("height",b),t.$digest()}),P=0,S=0,I=[],w=(Math.random()*j.fadeAmount).toFixed(3),M=h(w),C=Math.random()>j.stroke,R=new Victor(x/2,b/2),B=!1,A=!1,n();var o=angular.element(document);o.on("keydown",u);new Clipboard(".copy-link");l(),d()}function n(){$("canvas").mousemove(function(t){P=t.offsetX,S=t.offsetY}),$("canvas").click(function(t){j.clearPlacedPositions&&(j.clearPlacedPositions=!1,j.placedStartPositions=[]),j.placedStartPositions.push([t.offsetX,t.offsetY])}),$("canvas").mousedown(function(t){j.clearPlacedPositions&&(j.clearPlacedPositions=!1,j.placedStartPositions=[],j.placeStartPositionMarkers=[]),"place"==j.startPositionMode&&(0===j.placedStartPositions.length&&(j.placedStartPositions.push([P,S]),j.placeStartPositionMarkers.push({x:P,y:S,phase:1})),z=i(function(){var t=j.placedStartPositions[j.placedStartPositions.length-1];t=new Victor(t[0],t[1]);var e=new Victor(P,S);t.distance(e)>10&&(j.placedStartPositions.push([e.x,e.y]),j.placeStartPositionMarkers.push({x:e.x,y:e.y,phase:1}))},1e3/30))}),$("canvas").mouseup(function(){i.cancel(z)})}function r(t,e,o,i,a,n,r){this.acceleration=new Victor(0,0),this.velocity=new Victor(2*Math.random()-1,2*Math.random()-1),this.location=new Victor(t,e),this.colour="undefined"!=typeof r?r:M[Math.floor(Math.random()*M.length)],this.rot=0,this.radius="undefined"!=typeof o?o:5,this.desiredSeparation="undefined"!=typeof i?i:30,this.maxspeed="undefined"!=typeof a?a:5,this.maxforce="undefined"!=typeof n?n:.2,this.update=function(){this.velocity.add(this.acceleration),this.velocity=this.limitVector(this.velocity,this.maxspeed),this.location.add(this.velocity),this.location.x<0&&(this.location.x=x),this.location.x>x&&(this.location.x=0),this.location.y<0&&(this.location.y=b),this.location.y>b&&(this.location.y=0),this.acceleration.x*=0,this.acceleration.y*=0},this.applyForce=function(t){this.acceleration.add(t)},this.seek=function(t){var e=t.clone().subtract(this.location);return e.length()<400?(e.normalize(),e.x*=this.maxspeed,e.y*=this.maxspeed,e.subtract(this.velocity),this.limitVector(e,this.maxforce)):new Victor(0,0)},this.avoidFloor=function(){return this.location.y>.7*b?(steer=new Victor(0,-.5),steer):this.location.y<0?(steer=new Victor(0,.5),steer):new Victor(0,0)},this.separate=function(t){for(var e=t.length,o=new Victor(0,0),i=0,a=0;e>a;a++){var n=this.location.distance(t[a].location);if(n>0&&n<this.desiredSeparation){var r=this.location.clone().subtract(t[a].location);r.normalize(),o.add(r),i++}}return i>0?(o.divide(new Victor(i,i)),o.normalize(),o.x*=this.maxspeed,o.y*=this.maxspeed,o.subtract(this.velocity),this.limitVector(o,this.maxforce)):new Victor(0,0)},this.align=function(t){for(var e=new Victor(0,0),o=t.length,i=50,a=0,n=0;o>n;n++){var r=this.location.distance(t[n].location);r>0&&i>r&&(e.add(t[n].velocity),a++)}return a>0?(e.divide(new Victor(a,a)),e.normalize(),e.x*=this.maxspeed,e.y*=this.maxspeed,e.subtract(this.velocity),this.limitVector(e,this.maxforce)):new Victor(0,0)},this.cohesion=function(t){for(var e=new Victor(0,0),o=t.length,i=50,a=0,n=0;o>n;n++){var r=this.location.distance(t[n].location);r>0&&i>r&&(e.add(t[n].location),a++)}return a>0?(e.divide(new Victor(a,a)),this.seek(e)):new Victor(0,0)},this.applyBehaviours=function(t,e){var o=this.separate(t),i=this.align(t),a=this.cohesion(t);if(o.x*=1.5,o.y*=1.5,i.x*=.7,i.y*=.7,a.x*=.1,a.y*=.1,j.avoidMouse){var n=this.seek(e);n.x*=.5,n.y*=.5,this.applyForce(n)}this.applyForce(o),this.applyForce(i),this.applyForce(a)},this.draw=function(){v.fillStyle=this.colour.hex,v.beginPath(),v.arc(this.location.x,this.location.y,this.radius,0,2*Math.PI,!0),v.fill(),v.closePath(),C&&(v.beginPath(),v.arc(this.location.x,this.location.y,2*this.radius,0,2*Math.PI,!0),v.stroke(),v.closePath())},this.limitVector=function(t,e){return t.lengthSq()>e*e&&(t.normalize(),t.x*=e,t.y*=e),t}}function s(){I.length=0;var t=p();T=c();for(var e=0;V>e;e++)for(var o=T[e].radius,i=T[e].desiredSeparation,a=T[e].maxSpeed,n=T[e].maxForce,s=T[e].colour,d=0;d<j.numBirds/V;d++){var l=t[Math.floor(Math.random()*t.length)];I.push(new r(l[0],l[1],o,i,a,n,s))}}function c(){for(var t=[],e=0;V>e;e++)t[e]={radius:(Math.random()*j.maxRadius).toFixed(3),desiredSeparation:(Math.random()*j.desiredSeparation).toFixed(3),maxSpeed:(Math.random()*j.maxSpeed).toFixed(3),maxForce:(Math.random()*j.maxForce).toFixed(3),colour:M[Math.floor(Math.random()*M.length)]};return t}function d(){if(!A){R.x=P,R.y=S,v.fillStyle=k.rgb,v.fillRect(0,0,x,b);for(var t=0;F>t;t++)I[t]&&(I[t].applyBehaviours(I,R),I[t].update(),I[t].draw());B&&(B=!1,l())}"place"==j.startPositionMode&&j.showPlacedPositions&&j.placeStartPositionMarkers.forEach(function(t){v.fillStyle="#000",v.beginPath(),v.arc(t.x,t.y,5+t.phase,0,2*Math.PI,!0),v.stroke(),v.closePath(),t.phase+=.1,t.phase>10&&(t.phase=0)}),window.requestAnimationFrame(d)}function l(){v.clearRect(0,0,x,b),w=(Math.random()*j.fadeAmount).toFixed(3),M=h(w),k=M[Math.floor(Math.random()*M.length)],$("canvas").css({background:k.hex}),V=(Math.random()*j.numSets+1).toFixed(0),C=Math.random()>.5,F=j.numBirds,s(),o.cancel(U),U=o(function(){B=!0},1e3*j.regenTime),j.link=m()}function h(t){return t="undefined"!=typeof t?t:1,[{hex:"#1abc9c",rgb:"rgba(26, 188, 156,"+t+")"},{hex:"#16a085",rgb:"rgba(22, 160, 133,"+t+")"},{hex:"#2ecc71",rgb:"rgba(46, 204, 113,"+t+")"},{hex:"#27ae60",rgb:"rgba(39, 174, 96,"+t+")"},{hex:"#3498db",rgb:"rgba(52, 152, 219,"+t+")"},{hex:"#2980b9",rgb:"rgba(41, 128, 185,"+t+")"},{hex:"#9b59b6",rgb:"rgba(155, 89, 182,"+t+")"},{hex:"#8e44ad",rgb:"rgba(142, 68, 173,"+t+")"},{hex:"#34495e",rgb:"rgba(52, 73, 94,"+t+")"},{hex:"#2c3e50",rgb:"rgba(44, 62, 80,"+t+")"},{hex:"#f1c40f",rgb:"rgba(241, 196, 15,"+t+")"},{hex:"#f39c12",rgb:"rgba(243, 156, 18,"+t+")"},{hex:"#e67e22",rgb:"rgba(230, 126, 34,"+t+")"},{hex:"#d35400",rgb:"rgba(211, 84, 0,"+t+")"},{hex:"#e74c3c",rgb:"rgba(231, 76, 60,"+t+")"},{hex:"#c0392b",rgb:"rgba(192, 57, 43,"+t+")"},{hex:"#ecf0f1",rgb:"rgba(236, 240, 241,"+t+")"},{hex:"#bdc3c7",rgb:"rgba(189, 195, 199,"+t+")"},{hex:"#95a5a6",rgb:"rgba(149, 165, 166,"+t+")"},{hex:"#7f8c8d",rgb:"rgba(127, 140, 141,"+t+")"}]}function u(t){console.log(t.keyCode),32===t.keyCode&&(t.preventDefault(),l()),80===t.keyCode&&(A=!A),39==t.keyCode&&(j.placedStartPositions=j.placedStartPositions.map(function(t){return t[0]+=10,t})),37==t.keyCode&&(j.placedStartPositions=j.placedStartPositions.map(function(t){return t[0]-=10,t})),38==t.keyCode&&(j.placedStartPositions=j.placedStartPositions.map(function(t){return t[1]-=10,t})),40==t.keyCode&&(j.placedStartPositions=j.placedStartPositions.map(function(t){return t[1]+=10,t}))}function p(){switch(j.startPositionMode){case"center":return[[x/2,b/2]];case"sets":return[[x/2,b/2]];case"random":for(var t=[],e=0;e<j.numBirds;e++)t.push([Math.random()*x,Math.random()*b]);return t;case"place":return j.placedStartPositions.length>0?j.placedStartPositions:[[x/2,b/2]]}}function m(){var t="?";t+="numBirds="+j.numBirds,t+="&numSets="+j.numSets,t+="&fadeAmount="+j.fadeAmount,t+="&stroke="+j.stroke,t+="&maxRadius="+j.maxRadius,t+="&desiredSeparation="+j.desiredSeparation,t+="&maxSpeed="+j.maxSpeed,t+="&maxForce="+j.maxForce,t+="&regenTime="+j.regenTime,t+="&startPositionMode="+j.startPositionMode,t+="&avoidMouse="+j.avoidMouse,t+="&bgColourHex="+encodeURIComponent(k.hex),t+="&bgColourRGB="+encodeURIComponent(k.rgb),t+="&setVariables="+encodeURIComponent(JSON.stringify(T)),t+="&placedStartPositions="+encodeURIComponent(JSON.stringify(j.placedStartPositions));var e=window.location.origin+window.location.pathname+t;return e}function f(t){var e,o,i=decodeURIComponent(window.location.search.substring(1)),a=i.split("&");for(o=0;o<a.length;o++)if(e=a[o].split("="),e[0]===t)return void 0===e[1]?!0:e[1]}function g(t,e,o){var i=f(t);if("undefined"==typeof i)return o;switch(e){case"int":return parseInt(i);case"float":return parseFloat(i);case"json":return JSON.parse(decodeURIComponent(i));case"bool":return"true"==i;default:return decodeURIComponent(i)}}var x,b,y,v,P,S,w,M,k,V,F,C,R,I,B,A,U,z,T,j=this;j.numBirds=g("numBirds","int",300),j.numSets=g("numSets","int",10),j.fadeAmount=g("fadeAmount","float",.5),j.stroke=g("stroke","float",.5),j.maxRadius=g("maxRadius","int",7),j.desiredSeparation=g("desiredSeparation","int",30),j.maxSpeed=g("maxSpeed","float",6),j.maxForce=g("maxForce","float",1.4),j.regenTime=g("regenTime","int",20),j.positions=[[x/2,b/2]],j.placedStartPositions=g("placedStartPositions","json",[]),j.placeStartPositionMarkers=angular.copy(j.placedStartPositions),j.startPositionMode=g("startPositionMode","string","center"),j.showPlacedPositions=!1,j.clearPlacedPositions=!1,j.avoidMouse=g("avoidMouse","bool",!1),j.link="",a()}t.$inject=["$scope","$window","$timeout","$interval"],angular.module("petridish",[]),angular.module("petridish").controller("Animation",t)}();